using System;
using System.Security.Cryptography.X509Certificates;
using System.Xml.Linq;

namespace TonyCertificateCollector
{
    class Program
    {
        static void Main(string[] args)
        {
            // The cert name is starting with
            string certNamePrefix = "LaptopXXXXXXX";
            // The file will save to here
            string xmlFilePath = "Certificates.xml";
          
            // Open the certificate store (LocalMachine/My)
            X509Store store = new X509Store(StoreName.My, StoreLocation.LocalMachine);
            store.Open(OpenFlags.ReadOnly);

            // Create an XML document to store certificate details
            XDocument xmlDocument = new XDocument(new XElement("Certificates"));

            foreach (X509Certificate2 certificate in store.Certificates)
            {
                if (certificate.Subject.StartsWith(certNamePrefix, StringComparison.OrdinalIgnoreCase))
                {
                    // Record certificate name and expiration date
                    string certName = certificate.Subject;
                    DateTime expiryDate = certificate.NotAfter;

                    // Add to the XML document
                    xmlDocument.Root.Add(new XElement("Certificate",
                        new XElement("Name", certName),
                        new XElement("ExpiryDate", expiryDate.ToString("yyyy-MM-dd"))));
                }
            }

            xmlDocument.Save(xmlFilePath);

            Console.WriteLine($"Certificate details saved to {xmlFilePath}");
        }
    }
}
